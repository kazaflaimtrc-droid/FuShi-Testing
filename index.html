<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fushi Food Assistant</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: stretch;
      min-height: 100vh;
      margin: 0;
      padding: 40px 10px;
    }
    .chat-container {
      background: #ffffff;
      width: 100%;
      max-width: 420px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .top-bar {
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .lang-btn {
      font-size: 12px;
      padding: 4px 6px;
      border-radius: 10px;
      border: 1px solid #ccc;
      background: #f0f0f0;
      cursor: pointer;
    }
    .chat-window {
      flex: 1;
      min-height: 260px;
      max-height: 420px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      background: #fafafa;
    }
    .msg {
      margin-bottom: 8px;
      line-height: 1.4;
      font-size: 14px;
    }
    .bot {
      color: #333;
    }
    .user {
      text-align: right;
      color: #007bff;
    }
    /* ğŸ”´ Hot Keys å¿«æ·æŒ‰éˆ•æ¨£å¼ */
    .hot-keys {
      display: flex;
      gap: 6px;
      overflow-x: auto;
      padding: 8px 0;
      scrollbar-width: none;
    }
    .hot-keys::-webkit-scrollbar {
      display: none;
    }
    .hot-key-btn {
      background: #e8f0fe;
      color: #1a73e8;
      border: 1px solid #d2e3fc;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
      flex-shrink: 0;
    }
    .hot-key-btn:hover {
      background: #d2e3fc;
      transform: scale(1.05);
    }
    .input-area {
      display: flex;
      gap: 6px;
      margin-top: 4px;
    }
    .input-area input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    .input-area button {
      padding: 8px 10px;
      border-radius: 4px;
      border: none;
      background: #28a745;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      white-space: nowrap;
    }
    #reservationForm, #cateringForm {
      font-size: 13px;
      border-top: 1px solid #eee;
      margin-top: 6px;
      padding-top: 4px;
      display: none;
    }
    a { color: #007bff; }
    @media (max-width: 600px) {
      body { padding: 0; }
      .chat-container { max-width: 100%; height: 100vh; border-radius: 0; }
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="top-bar">
      <span id="titleText">ç¦é£Ÿå°åŠ©æ‰‹</span>
      <button id="langBtn" class="lang-btn">ä¸­æ–‡ / EN</button>
    </div>

    <div id="chat" class="chat-window"></div>

    <!-- ğŸ”´ Hot Keys å¿«æ·æŒ‰éˆ• -->
    <div class="hot-keys">
      <button class="hot-key-btn" onclick="quickAction('ä»Šæ—¥é£Ÿå’©å¥½ï¼Ÿ')">ğŸ´ ä»Šæ—¥é£Ÿå’©å¥½ï¼Ÿ</button>
      <button class="hot-key-btn" onclick="quickAction('å¹«æˆ‘è¨‚ä½')">ğŸ“… å¹«æˆ‘è¨‚ä½</button>
      <button class="hot-key-btn" onclick="quickAction('å¤–è³£è‡ªå–')">ğŸ¥¡ å¤–è³£è‡ªå–</button>
      <button class="hot-key-btn" onclick="quickAction('åˆ°æœƒæœå‹™')">ğŸ“¦ åˆ°æœƒæœå‹™</button>
      <button class="hot-key-btn" onclick="quickAction('æœ€æ–°å„ªæƒ ')">ğŸ§§ æœ€æ–°å„ªæƒ </button>
    </div>

    <!-- è¨‚ä½è¡¨å–® -->
    <div id="reservationForm">
      <div style="margin-bottom:4px;">
        <label>äººæ•¸ï¼š</label>
        <input id="rsvPax" type="number" min="1" style="width:80px;">
      </div>
      <div style="margin-bottom:4px;">
        <label>æ—¥æœŸï¼š</label>
        <input id="rsvDate" type="date">
      </div>
      <div style="margin-bottom:4px;">
        <label>æ™‚é–“ï¼š</label>
        <input id="rsvTime" type="time">
      </div>
      <div style="margin-bottom:4px;">
        <label>é›»è©±ï¼š</label>
        <input id="rsvPhone" type="tel" style="width:140px;">
      </div>
      <button id="rsvWaBtn" style="background:#25d366;">ğŸ“± WhatsApp ç¢ºèª</button>
    </div>

    <!-- åˆ°æœƒè¡¨å–® -->
    <div id="cateringForm">
      <div style="margin-bottom:4px;">
        <label>ç”¨é€”ï¼š</label>
        <input id="catOccasion" type="text" placeholder="å…¬å¸æ´»å‹•/ç”Ÿæ—¥æœƒ">
      </div>
      <div style="margin-bottom:4px;">
        <label>äººæ•¸ï¼š</label>
        <input id="catPax" type="text" placeholder="20äºº">
      </div>
      <div style="margin-bottom:4px;">
        <label>æ—¥æœŸï¼š</label>
        <input id="catDate" type="date">
      </div>
      <div style="margin-bottom:4px;">
        <label>è¯çµ¡ï¼š</label>
        <input id="catContact" type="text" placeholder="Mr Chan 9xxxxxxx">
      </div>
      <button id="cateringWaBtn" style="background:#25d366;">ğŸ“± WhatsApp å‚³é€</button>
    </div>

    <div class="input-area">
      <input id="userInput" type="text" placeholder="è«‹ç›´æ¥è¼¸å…¥ä½ çš„å•é¡Œ...">
      <button id="sendBtn">é€å‡º</button>
    </div>
  </div>

  <script>
    // ğŸ”´ æ›´æ–°ç‚ºä½ å˜…æ­£ç¢º API URL
    const MENU_API_URL = 'https://script.google.com/macros/s/1ttd8WfW8V-5JwTv9-aTWlji1qW8N3f2jUjO13zMqtqc/exec?type=menu';
    const WA_PHONE = '85264067605';
    
    let menuData = [];
    let currentLang = 'zh';

    // ğŸ”´ åŠ è¼‰èœå–®æ•¸æ“š
    async function loadMenu() {
      try {
        const res = await fetch(MENU_API_URL);
        menuData = await res.json();
        console.log('èœå–®åŠ è¼‰æˆåŠŸï¼š', menuData.length, 'é …');
        welcome();
      } catch (e) {
        console.error('èœå–®åŠ è¼‰å¤±æ•—ï¼š', e);
        welcome();
      }
    }

    // ğŸ”´ å¿«æ·éµè™•ç†
    function quickAction(text) {
      handleKeyword(text);
    }

    // ğŸ”´ ä¸»è¦é‚è¼¯è™•ç†
    function handleKeyword(raw) {
      addUser(raw);
      const t = raw.toLowerCase();

      if (t.includes('é£Ÿå’©') || t.includes('æ¨ä»‹') || t.includes('recommend')) {
        addBot('ä»Šæ—¥æœ‰å†‡ç‰¹åˆ¥æƒ³é£Ÿå˜…ï¼Ÿä¾‹å¦‚ï¼šç‰›ã€é›ã€è±¬ã€æµ·é®®ã€ç´ é£Ÿ');
        return;
      }

      // ğŸ”´ è‚‰é¡æ¨è–¦ï¼ˆä¾å®¶æœƒç”¨ä½  Sheet å˜…æ•¸æ“šï¼‰
      const meatMap = {
        'ç‰›': 'Beef', 'beef': 'Beef',
        'é›': 'Chicken', 'chicken': 'Chicken', 
        'è±¬': 'Pork', 'pork': 'Pork',
        'æµ·é®®': 'Sea Food', 'seafood': 'Sea Food',
        'ç´ ': 'Vegan', 'vegan': 'Vegan'
      };

      for (let [key, tag] of Object.entries(meatMap)) {
        if (t.includes(key)) {
          showRecommendation(tag);
          return;
        }
      }

      // ğŸ”´ å…¶ä»–åŠŸèƒ½
      if (t.includes('è¨‚ä½') || t.includes('book')) {
        document.getElementById('reservationForm').style.display = 'block';
        addBot('å¥½å‘€ï¼è«‹å¡«å¯«è¨‚ä½è³‡æ–™ï¼š');
        return;
      }

      if (t.includes('åˆ°æœƒ') || t.includes('catering')) {
        document.getElementById('cateringForm').style.display = 'block';
        addBot('åˆ°æœƒæœå‹™è«‹å¡«å¯«è³‡æ–™ï¼š');
        return;
      }

      if (t.includes('å¤–è³£') || t.includes('è‡ªå–')) {
        addBot('å¤–è³£è‡ªå–å¯ä»¥ç¶“å‘¢å€‹é€£çµè½å–®ï¼š');
        addBotHTML('ğŸ‘‰ <a href="https://fushi.softether.net/byod/byod.aspx?data=hwZVZ%2BqRSxraTV9YHWCRmw%3D%3D" target="_blank">ç¶²ä¸Šè½å–®</a>');
        return;
      }

      if (t.includes('å„ªæƒ ')) {
        addBot('æœ€æ–°å„ªæƒ å¯ä»¥ç‡é›»å­é¤ç‰Œæœ€å¾Œä¸€é ï¼');
        addBotHTML('ğŸ‘‰ <a href="https://heyzine.com/flip-book/FuShiç¦é£ŸMenu" target="_blank">é›»å­é¤ç‰Œ</a>');
        return;
      }

      addBot('ä½ å¯ä»¥è©¦å“ï¼šä»Šæ—¥é£Ÿå’©å¥½ï¼Ÿã€å¹«æˆ‘è¨‚ä½ã€åˆ°æœƒæœå‹™ã€å¤–è³£è‡ªå–ã€æœ€æ–°å„ªæƒ ');
    }

    function showRecommendation(meatTag) {
      const list = menuData.filter(d => d.meat?.toLowerCase() === meatTag.toLowerCase()).slice(0, 3);
      
      if (list.length === 0) {
        addBot('æš«æ™‚æœªæœ‰å‘¢é¡èœå¼ï¼Œå¯ä»¥ç‡å“é›»å­é¤ç‰Œï¼Ÿ');
        return;
      }

      addBot(`æˆ‘å¹«ä½ æ€å’—å¹¾æ¬¾ ${meatTag} èœå¼ï¼š`);
      const lines = list.map(d => `â€¢ ${d.item_zh || d.item} (${d.item_en || ''})${d.price ? ' $' + d.price : ''}`);
      addBotHTML(lines.join('<br>'));
      addBotHTML('ğŸ‘‰ <a href="https://heyzine.com/flip-book/FuShiç¦é£ŸMenu" target="_blank">ç‡å®Œæ•´é¤ç‰Œ</a>');
    }

    function addBot(text) {
      const div = document.createElement('div');
      div.className = 'msg bot';
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function addBotHTML(html) {
      const div = document.createElement('div');
      div.className = 'msg bot';
      div.innerHTML = html;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function addUser(text) {
      const div = document.createElement('div');
      div.className = 'msg user';
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function welcome() {
      chat.innerHTML = '';
      addBot('å“ˆå›‰ï½æ­¡è¿åšŸåˆ°ã€Œç¦é£Ÿã€ï¼ğŸ‘‹');
      addBot('ä½ å¯ä»¥ç›´æ¥æ’³å¿«æ·æŒ‰éˆ•ï¼Œæˆ–è€…æ‰“å­—å•æˆ‘ï¼šæœ‰å’©æ¨ä»‹ã€è¨‚ä½ã€åˆ°æœƒã€å¤–è³£ã€å„ªæƒ ç­‰ï¼');
    }

    // ğŸ”´ WhatsApp è¡¨å–®æäº¤
    document.getElementById('rsvWaBtn').onclick = () => {
      const pax = document.getElementById('rsvPax').value;
      const date = document.getElementById('rsvDate').value;
      const time = document.getElementById('rsvTime').value;
      const phone = document.getElementById('rsvPhone').value;
      
      const text = `æˆ‘æƒ³å–ºã€Œç¦é£Ÿã€è¨‚ä½ï¼š
äººæ•¸ï¼š${pax}ä½
æ—¥æœŸï¼š${date}
æ™‚é–“ï¼š${time}
é›»è©±ï¼š${phone}
éº»ç…©ç¢ºèªä½ï¼Œå””è©²æ™’ï¼`;
      window.open(`https://wa.me/${WA_PHONE}?text=${encodeURIComponent(text)}`, '_blank');
      addBot('å·²é–‹ WhatsAppï¼ŒåŒäº‹æœƒå³æ™‚å›è¦†ä½ ï¼ğŸ™');
    };

    document.getElementById('cateringWaBtn').onclick = () => {
      const occasion = document.getElementById('catOccasion').value;
      const pax = document.getElementById('catPax').value;
      const date = document.getElementById('catDate').value;
      const contact = document.getElementById('catContact').value;
      
      const text = `æˆ‘æƒ³å®‰æ’åˆ°æœƒæœå‹™ï¼š
ç”¨é€”ï¼š${occasion}
äººæ•¸ï¼š${pax}
æ—¥æœŸï¼š${date}
è¯çµ¡ï¼š${contact}
éº»ç…©æä¾›å¥—é¤å»ºè­°ï¼Œå¤šè¬ï¼`;
      window.open(`https://wa.me/${WA_PHONE}?text=${encodeURIComponent(text)}`, '_blank');
      addBot('å·²é–‹ WhatsAppï¼ŒåŒäº‹æœƒå³æ™‚è·Ÿé€²ï¼ğŸ™');
    };

    // ğŸ”´ äº‹ä»¶ç¶å®š
    document.getElementById('sendBtn').onclick = () => {
      const val = document.getElementById('userInput').value.trim();
      if (val) {
        handleKeyword(val);
        document.getElementById('userInput').value = '';
      }
    };

    document.getElementById('userInput').onkeydown = (e) => {
      if (e.key === 'Enter') {
        document.getElementById('sendBtn').onclick();
      }
    };

    // ğŸ”´ èªè¨€åˆ‡æ›ï¼ˆå¯é¸ï¼‰
    document.getElementById('langBtn').onclick = () => {
      currentLang = currentLang === 'zh' ? 'en' : 'zh';
      document.getElementById('langBtn').textContent = currentLang === 'zh' ? 'EN' : 'ä¸­æ–‡';
      addBot(currentLang === 'zh' ? 'å·²åˆ‡æ›ä¸­æ–‡' : 'Switched to English');
    };

    // ğŸ”´ é é¢è¼‰å…¥å®Œæˆ
    window.onload = loadMenu;
  </script>
</body>
</html>