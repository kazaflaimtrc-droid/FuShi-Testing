<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FuShi</title>
  <style>
    :root{
      --green:#2E7D32;
      --green2:#43A047;
      --gold:#FFB74D;
      --bg:#F6EAD3;
      --ink:#1f2d1f;
      --card:rgba(255,255,255,.92);
      --line:rgba(46,125,50,.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; padding:18px 10px; display:flex; justify-content:center;
      background: radial-gradient(1200px 700px at 20% 10%, #fff 0%, var(--bg) 45%, #FDF2E9 100%);
      font-family:-apple-system,BlinkMacSystemFont,"Noto Sans TC","PingFang TC",Arial,sans-serif;
      color:var(--ink);
    }
    .chat-container{
      width:100%; max-width:460px; background:var(--card); border:1px solid var(--line);
      border-radius:22px; box-shadow:0 18px 45px rgba(0,0,0,.10);
      padding:16px; display:flex; flex-direction:column; gap:10px; position:relative; overflow:hidden;
    }
    .chat-container:before{
      content:''; position:absolute; inset:-2px;
      background:linear-gradient(60deg, rgba(46,125,50,.45), rgba(255,183,77,.35));
      z-index:-1; border-radius:24px; filter:blur(18px); opacity:.55;
    }
    .top-bar{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:6px 6px 12px 6px; border-bottom:1px solid var(--line);
    }
    .brand{display:flex; align-items:center; gap:10px; min-width:0;}
    .brand img{width:56px;height:56px;border-radius:12px;
      object-fit:cover;border:1px solid rgba(46,125,50,.25);background:#fff;;
    }
    .brand .title{display:flex; flex-direction:column; gap:2px; min-width:0;}
    .brand .title strong{
      font-size:18px; letter-spacing:.4px; color:var(--green); line-height:1.1;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .brand .title span{
      font-size:12px; color:rgba(31,45,31,.7);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .lang-btn{
      border:1px solid rgba(46,125,50,.35); background:rgba(46,125,50,.06);
      color:var(--green); padding:7px 10px; border-radius:999px;
      font-size:12px; cursor:pointer; font-weight:700; transition:.15s; flex-shrink:0;
    }
    .lang-btn:hover{background:rgba(46,125,50,.12); transform:translateY(-1px);}
    .chat-window{
      flex:1; min-height:280px; max-height:460px; overflow:auto;
      border:1px solid var(--line); border-radius:16px; padding:12px;
      background:rgba(255,255,255,.75);
    }
    .msg{
      margin:0 0 10px 0; font-size:14px; line-height:1.5;
      padding:10px 12px; border-radius:14px; max-width:92%; word-break:break-word;
    }
    .bot{background:linear-gradient(135deg, rgba(46,125,50,.10), rgba(46,125,50,.05)); border-left:4px solid rgba(46,125,50,.55);}
    .user{margin-left:auto; text-align:right; background:linear-gradient(135deg, rgba(255,183,77,.22), rgba(255,183,77,.10)); border-right:4px solid rgba(255,183,77,.75);}

    .hot-keys{display:flex; gap:8px; overflow-x:auto; padding:2px 2px; scrollbar-width:none;}
    .hot-keys::-webkit-scrollbar{display:none}
    .hot-key-btn{
      border:1px solid rgba(46,125,50,.30); background:rgba(46,125,50,.08); color:var(--green);
      padding:9px 12px; border-radius:999px; font-size:13px; cursor:pointer; white-space:nowrap;
      transition:.15s; flex-shrink:0; font-weight:700;
    }
    .hot-key-btn:hover{background:rgba(46,125,50,.14); transform:translateY(-1px);}

    .forms{display:flex; flex-direction:column; gap:10px;}
    #reservationForm, #cateringForm{
      display:none; border:1px solid var(--line); border-radius:16px; padding:12px;
      background:rgba(46,125,50,.04);
    }
    .row{display:flex; align-items:center; gap:10px; margin-bottom:8px;}
    .row label{width:92px; font-size:13px; color:rgba(31,45,31,.85); flex-shrink:0;}
    .row input, .row textarea{
      width:100%; font-size:13px; padding:8px 10px; border-radius:10px;
      border:1px solid rgba(0,0,0,.15); background:rgba(255,255,255,.9); outline:none;
    }
    .row textarea{min-height:56px; resize:vertical;}
    .wa-btn{
      width:100%; border:none; border-radius:999px; padding:10px 12px; cursor:pointer;
      font-weight:800; color:#fff; background:linear-gradient(135deg, #25D366, #128C7E); transition:.15s;
    }
    .wa-btn:hover{transform:translateY(-1px);}
    .input-area{display:flex; gap:8px; border-top:1px solid var(--line); padding-top:10px;}
    .input-area input{
      flex:1; border:1px solid rgba(46,125,50,.25); border-radius:999px; padding:11px 12px;
      font-size:14px; outline:none; background:rgba(255,255,255,.92);
    }
    .input-area input:focus{border-color:rgba(46,125,50,.55); box-shadow:0 0 0 4px rgba(46,125,50,.08);}
    .input-area button{
      border:none; border-radius:999px; padding:11px 16px; cursor:pointer; color:#fff;
      font-weight:900; background:linear-gradient(135deg, var(--green), var(--green2)); transition:.15s; white-space:nowrap;
    }
    .input-area button:hover{transform:translateY(-1px);}
    a{color:#1a73e8; text-decoration:none;}
    a:hover{text-decoration:underline;}
    @media (max-width:600px){
      body{padding:0;}
      .chat-container{max-width:100%; height:100vh; border-radius:0; box-shadow:none;}
      .chat-window{max-height:none;}
    }
  </style>
</head>

<body>
  <div class="chat-container">
    <div class="top-bar">
      <div class="brand">
        <img id="logoImg" alt="FuShi Logo" />
        <div class="title">
          <strong id="titleText"></strong>
          <span id="subTitleText"></span>
        </div>
      </div>
      <button id="langBtn" class="lang-btn"></button>
    </div>

    <div id="chat" class="chat-window"></div>

    <div class="hot-keys" id="hotKeys"></div>

    <div class="forms">
      <div id="reservationForm">
        <div class="row"><label id="lblRsvPax"></label><input id="rsvPax" type="number" min="1"></div>
        <div class="row"><label id="lblRsvDate"></label><input id="rsvDate" type="date"></div>
        <div class="row"><label id="lblRsvTime"></label><input id="rsvTime" type="time"></div>
        <div class="row"><label id="lblRsvPhone"></label><input id="rsvPhone" type="tel"></div>
        <button id="rsvWaBtn" class="wa-btn"></button>
      </div>

      <div id="cateringForm">
        <div class="row"><label id="lblCatOccasion"></label><input id="catOccasion" type="text"></div>
        <div class="row"><label id="lblCatPax"></label><input id="catPax" type="text"></div>
        <div class="row"><label id="lblCatDate"></label><input id="catDate" type="date"></div>
        <div class="row"><label id="lblCatTime"></label><input id="catTime" type="time"></div>
        <div class="row"><label id="lblCatItems"></label><textarea id="catItems"></textarea></div>
        <div class="row"><label id="lblCatContact"></label><input id="catContact" type="text"></div>
        <button id="cateringWaBtn" class="wa-btn"></button>
      </div>
    </div>

    <div class="input-area">
      <input id="userInput" type="text" />
      <button id="sendBtn"></button>
    </div>
  </div>

  <script>
    /************ ä½ è¦æ”¹ ************/
    const MENU_API_URL = 'https://script.google.com/macros/s/AKfycbyuQzQMtTx9vZYuVLl6NAgLUKqC6BmZ0wwm_1L1CfDWVYpGBHtta9AF5FvpUf4odfPI_A/exec';
    const LOGO_SRC = 'https://drive.google.com/file/d/1EGf3hy_wC8uTLRwX6wHnbmWqbVxjikR7'; // åŒ folder æ”¾ logo æª”ï¼Œæˆ–æ”¹æˆ https://...
    const WA_PHONE = '85264067605';
    const EMENU_URL = 'https://heyzine.com/flip-book/FuShiç¦é£ŸMenu';
    const ORDER_URL = 'https://fushi.softether.net/byod/byod.aspx?data=hwZVZ%2BqRSxraTV9YHWCRmw%3D%3D';

    /************ i18n ************/
    const I18N = {
      zh: {
        title: 'ç¦é£Ÿå°åŠ©æ‰‹',
        sub: 'å³å•å³ç­” Â· è¨‚ä½ Â· åˆ°æœƒ Â· å¤–è³£',
        placeholder: 'è«‹ç›´æ¥è¼¸å…¥ä½ çš„å•é¡Œï¼Œä¾‹å¦‚ï¼šæœ‰å’©å¥½é£Ÿã€è¨‚ä½ã€åˆ°æœƒã€å¤–è³£ã€å„ªæƒ â€¦',
        btnSend: 'é€å‡º',
        welcome: ['å“ˆå›‰ï½ æ­¡è¿åšŸåˆ°ã€Œç¦é£Ÿã€ï¼', 'ä½ å¯ä»¥æ’³ä¸‹é¢å¿«æ·éµï¼Œæˆ–è€…ç›´æ¥æ‰“å­—å•æˆ‘ã€‚'],
        askMeat: 'ä»Šæ—¥æƒ³é£Ÿå’©ï¼Ÿä¾‹å¦‚ï¼šç‰›ã€é›ã€è±¬ã€æµ·é®®ã€ç´ é£Ÿã€‚',
        menuFail: 'æš«æ™‚æœªèƒ½è¼‰å…¥æœ€æ–°èœå–®ï¼Œä½ å¯ä»¥å…ˆç‡é›»å­é¤ç‰Œï¼š',
        picked: 'æˆ‘å¹«ä½ æ€å’—å¹¾æ¬¾ï¼š',
        noMatch: 'æš«æ™‚æœªæµåˆ°ç¬¦åˆæ¢ä»¶å˜…èœå¼ï¼Œä½ å¯ä»¥é–‹é›»å­é¤ç‰Œç‡æ›´å¤šï¼š',
        menuLink: 'é›»å­é¤ç‰Œ',
        orderLink: 'ç¶²ä¸Šè½å–®',
        rsvIntro: 'å¥½å‘€ï½è«‹å¡«å¯«è¨‚ä½è³‡æ–™ï¼Œç„¶å¾Œç”¨ WhatsApp å‚³é€ä¿¾æˆ‘å“‹ç¢ºèªã€‚',
        catIntro: 'åˆ°æœƒï¼å¤§é‡è¨‚è³¼ï¼šå¡«å¯«è³‡æ–™å¾Œç”¨ WhatsApp å‚³é€ä¿¾æˆ‘å“‹ã€‚',
        sent: 'å·²é–‹å•Ÿ WhatsAppï¼Œæˆ‘å“‹æœƒç›¡å¿«å›è¦†ä½ ç¢ºèªã€‚',
        labels: { pax:'äººæ•¸', date:'æ—¥æœŸ', time:'æ™‚é–“', phone:'é›»è©±', occ:'ç”¨é€”', qty:'äººæ•¸ï¼ä»½é‡', items:'èœå¼ / Set', contact:'è¯çµ¡' },
        btn: { rsv:'ç”¨ WhatsApp å‚³é€è¨‚ä½è³‡æ–™', cat:'ç”¨ WhatsApp å‚³é€åˆ°æœƒï¼å¤§é‡è¨‚è³¼è³‡æ–™' },
        hk: [
          { label:'ğŸ´ ä»Šæ—¥é£Ÿå’©å¥½ï¼Ÿ', text:'ä»Šæ—¥é£Ÿå’©å¥½ï¼Ÿ' },
          { label:'ğŸ“… è¨‚ä½', text:'å¹«æˆ‘è¨‚ä½' },
          { label:'ğŸ“¦ åˆ°æœƒ', text:'åˆ°æœƒï¼å¤§é‡è¨‚è³¼' },
          { label:'ğŸ¥¡ å¤–è³£', text:'å¤–è³£ï¼è‡ªå–' },
          { label:'ğŸ§§ å„ªæƒ ', text:'æœ‰å†‡å„ªæƒ ' }
        ],
        langBtn: 'EN'
      },
      en: {
        title: 'FuShi Food Assistant',
        sub: 'Ask Â· Booking Â· Catering Â· Takeaway',
        placeholder: 'Type your question: menu, recommendation, booking, catering, takeaway, promotionâ€¦',
        btnSend: 'Send',
        welcome: ['Hi! Welcome to "FuShi".', 'Use the hot keys below or type your question.'],
        askMeat: 'Any preference today? Beef / Chicken / Pork / Seafood / Vegan.',
        menuFail: 'Unable to load live menu. You can open the e-menu:',
        picked: 'Here are some picks:',
        noMatch: 'No matching dishes. You can open the e-menu:',
        menuLink: 'E-menu',
        orderLink: 'Online order',
        rsvIntro: 'Sureâ€”fill in booking details and send via WhatsApp for confirmation.',
        catIntro: 'Catering / bulk order: fill in details and send via WhatsApp.',
        sent: 'WhatsApp opened. We will reply shortly to confirm.',
        labels: { pax:'People', date:'Date', time:'Time', phone:'Phone', occ:'Occasion', qty:'Pax / Quantity', items:'Set / Dishes', contact:'Contact' },
        btn: { rsv:'Send booking via WhatsApp', cat:'Send catering / bulk order via WhatsApp' },
        hk: [
          { label:'ğŸ´ What to eat?', text:'what to eat' },
          { label:'ğŸ“… Booking', text:'book a table' },
          { label:'ğŸ“¦ Catering', text:'catering' },
          { label:'ğŸ¥¡ Takeaway', text:'takeaway' },
          { label:'ğŸ§§ Promo', text:'promotion' }
        ],
        langBtn: 'ä¸­æ–‡'
      }
    };

    /************ DOM ************/
    const chat = document.getElementById('chat');
    const input = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const langBtn = document.getElementById('langBtn');
    const titleText = document.getElementById('titleText');
    const subTitleText = document.getElementById('subTitleText');
    const hotKeysEl = document.getElementById('hotKeys');

    const rsvForm = document.getElementById('reservationForm');
    const cateringForm = document.getElementById('cateringForm');

    const rsvPaxInput = document.getElementById('rsvPax');
    const rsvDateInput = document.getElementById('rsvDate');
    const rsvTimeInput = document.getElementById('rsvTime');
    const rsvPhoneInput = document.getElementById('rsvPhone');
    const rsvWaBtn = document.getElementById('rsvWaBtn');

    const catOccasionInput = document.getElementById('catOccasion');
    const catPaxInput = document.getElementById('catPax');
    const catDateInput = document.getElementById('catDate');
    const catTimeInput = document.getElementById('catTime');
    const catItemsInput = document.getElementById('catItems');
    const catContactInput = document.getElementById('catContact');
    const cateringWaBtn = document.getElementById('cateringWaBtn');

    document.getElementById('logoImg').src = LOGO_SRC;

    /************ state ************/
    let currentLang = getLangFromUrlOrStorage();
    let menuData = []; // normalized

    /************ helpers ************/
    function addBot(text){
      const div = document.createElement('div');
      div.className = 'msg bot';
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }
    function addBotHTML(html){
      const div = document.createElement('div');
      div.className = 'msg bot';
      div.innerHTML = html;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }
    function addUser(text){
      const div = document.createElement('div');
      div.className = 'msg user';
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }
    function norm(s){ return (s || '').toString().toLowerCase().trim(); }

    /************ language (reload) ************/
    function getLangFromUrlOrStorage(){
      const p = new URLSearchParams(location.search);
      const urlLang = (p.get('lang') || '').toLowerCase();
      const store = (localStorage.getItem('lang') || '').toLowerCase();
      if (urlLang === 'zh' || urlLang === 'en') return urlLang;
      if (store === 'zh' || store === 'en') return store;
      return 'zh';
    }
    function switchLangAndReload(next){
      localStorage.setItem('lang', next);
      const url = new URL(location.href);
      url.searchParams.set('lang', next);
      location.replace(url.toString());
    }

    function applyLanguageUI(){
      const t = I18N[currentLang];
      titleText.textContent = t.title;
      subTitleText.textContent = t.sub;
      input.placeholder = t.placeholder;
      sendBtn.textContent = t.btnSend;
      langBtn.textContent = t.langBtn;

      document.getElementById('lblRsvPax').textContent = t.labels.pax;
      document.getElementById('lblRsvDate').textContent = t.labels.date;
      document.getElementById('lblRsvTime').textContent = t.labels.time;
      document.getElementById('lblRsvPhone').textContent = t.labels.phone;

      document.getElementById('lblCatOccasion').textContent = t.labels.occ;
      document.getElementById('lblCatPax').textContent = t.labels.qty;
      document.getElementById('lblCatDate').textContent = t.labels.date;
      document.getElementById('lblCatTime').textContent = t.labels.time;
      document.getElementById('lblCatItems').textContent = t.labels.items;
      document.getElementById('lblCatContact').textContent = t.labels.contact;

      rsvWaBtn.textContent = t.btn.rsv;
      cateringWaBtn.textContent = t.btn.cat;

      renderHotKeys();
    }

    function renderHotKeys(){
      const t = I18N[currentLang];
      hotKeysEl.innerHTML = '';
      t.hk.forEach(h => {
        const b = document.createElement('button');
        b.className = 'hot-key-btn';
        b.textContent = h.label;
        b.dataset.text = h.text;
        hotKeysEl.appendChild(b);
      });
    }

    function welcome(){
      const t = I18N[currentLang];
      chat.innerHTML = '';
      rsvForm.style.display = 'none';
      cateringForm.style.display = 'none';
      t.welcome.forEach(addBot);
    }

    /************ menu normalize ************/
    function normalizeRow(row){
      const period = row.period || row['Available Period'] || 'All Day';
      const nameZh = row.item_zh || row['Item in Chinese'] || row.item || '';
      const nameEn = row.item_en || row['Item in english'] || row['Item in English'] || '';
      const meat = row.meat || row.Meat || row['è‚‰é¡'] || '';
      const price = (row.price ?? row.Price ?? null);

      return {
        period: (period || 'All Day').toString().trim(),
        nameZh: (nameZh || '').toString().trim(),
        nameEn: (nameEn || '').toString().trim(),
        meat: (meat || '').toString().trim(),
        price: (price === '' || price == null) ? null : Number(price)
      };
    }

    async function loadMenu(){
      const t = I18N[currentLang];
      try{
        const res = await fetch(MENU_API_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        menuData = (Array.isArray(data) ? data : [])
          .map(normalizeRow)
          .filter(x => x.nameZh || x.nameEn);
      }catch(e){
        console.error(e);
        addBot(t.menuFail);
        addBotHTML(`ğŸ‘‰ <a href="${EMENU_URL}" target="_blank">${t.menuLink}</a>`);
      }
    }

    /************ recommendation ************/
    function chooseMeatTag(raw){
      const s = norm(raw);
      if (s.includes('ç‰›') || s.includes('beef')) return 'Beef';
      if (s.includes('é›') || s.includes('chicken')) return 'Chicken';
      if (s.includes('è±¬') || s.includes('pork')) return 'Pork';
      if (s.includes('æµ·é®®') || s.includes('seafood') || s.includes('sea food')) return 'Sea Food';
      if (s.includes('ç´ ') || s.includes('vegan') || s.includes('veg')) return 'Vegan';
      return null;
    }

    function formatLine(d){
      const name = (currentLang === 'zh') ? (d.nameZh || d.nameEn) : (d.nameEn || d.nameZh);
      const alt  = (currentLang === 'zh') ? (d.nameEn ? `ï¼ˆ${d.nameEn}ï¼‰` : '') : (d.nameZh ? `(${d.nameZh})` : '');
      const price = (d.price == null || Number.isNaN(d.price)) ? '' : ` - HK$${d.price}`;
      return `â€¢ ${name}${alt}${price}`;
    }

    function recommend(meatTag){
      const t = I18N[currentLang];
      if(!menuData.length){
        addBot(t.menuFail);
        addBotHTML(`ğŸ‘‰ <a href="${EMENU_URL}" target="_blank">${t.menuLink}</a>`);
        return;
      }

      const list = menuData.filter(d => norm(d.meat) === norm(meatTag)).slice(0, 3);
      if(!list.length){
        addBot(t.noMatch);
        addBotHTML(`ğŸ‘‰ <a href="${EMENU_URL}" target="_blank">${t.menuLink}</a>`);
        return;
      }

      addBot(t.picked);
      addBotHTML(list.map(formatLine).join('<br>'));
      addBotHTML(`ğŸ‘‰ <a href="${EMENU_URL}" target="_blank">${t.menuLink}</a>`);
    }

    /************ flows ************/
    function flowEat(){ rsvForm.style.display='none'; cateringForm.style.display='none'; addBot(I18N[currentLang].askMeat); }
    function flowReservation(){ cateringForm.style.display='none'; rsvForm.style.display='block'; addBot(I18N[currentLang].rsvIntro); }
    function flowCatering(){ rsvForm.style.display='none'; cateringForm.style.display='block'; addBot(I18N[currentLang].catIntro); }

    function openWhatsAppReservation(){
      const pax = rsvPaxInput.value || '';
      const date = rsvDateInput.value || '';
      const time = rsvTimeInput.value || '';
      const contact = rsvPhoneInput.value || '';

      const msgZh =
`æˆ‘æƒ³å–ºã€Œç¦é£Ÿã€è¨‚ä½ï¼š
äººæ•¸ï¼š${pax ? pax + 'ä½' : ''}
æ—¥æœŸï¼š${date}
æ™‚é–“ï¼š${time}
è¯çµ¡é›»è©±ï¼š${contact}
éº»ç…©å¹«æˆ‘ç¢ºèªå®‰æ’ï¼Œå””è©²æ™’ï¼`.trim();

      const msgEn =
`I would like to make a booking at "FuShi":
People: ${pax}
Date: ${date}
Time: ${time}
Contact: ${contact}
Please help confirm the booking. Thank you!`.trim();

      const text = (currentLang === 'zh') ? msgZh : msgEn;
      window.open(`https://wa.me/${WA_PHONE}?text=${encodeURIComponent(text)}`, '_blank');
      addBot(I18N[currentLang].sent);
    }

    function openWhatsAppCatering(){
      const occ = catOccasionInput.value || '';
      const pax = catPaxInput.value || '';
      const date = catDateInput.value || '';
      const time = catTimeInput.value || '';
      const items = catItemsInput.value || '';
      const contact = catContactInput.value || '';

      const msgZh =
`æˆ‘æƒ³å–ºã€Œç¦é£Ÿã€å®‰æ’åˆ°æœƒï¼å¤§é‡è¨‚è³¼ï¼š
ç”¨é€”ï¼š${occ}
äººæ•¸ï¼ä»½é‡ï¼šç´„ ${pax}
æ—¥æœŸï¼š${date}
æ™‚é–“ï¼š${time}
å¤§ç´„æƒ³è¦å˜…å¥—é¤ï¼èœå¼ï¼š${items}
è¯çµ¡äººï¼é›»è©±ï¼š${contact}
éº»ç…©æä¾›å¥—é¤æˆ–å»ºè­°ï¼Œå¤šè¬ï¼`.trim();

      const msgEn =
`I would like to arrange catering / bulk order at "FuShi":
Occasion: ${occ}
Pax / Quantity: ${pax}
Date: ${date}
Time: ${time}
Preferred sets / dishes: ${items}
Contact: ${contact}
Please suggest suitable sets/options. Thank you!`.trim();

      const text = (currentLang === 'zh') ? msgZh : msgEn;
      window.open(`https://wa.me/${WA_PHONE}?text=${encodeURIComponent(text)}`, '_blank');
      addBot(I18N[currentLang].sent);
    }

    /************ main router ************/
    function handleKeyword(raw){
      const t = I18N[currentLang];
      const s = norm(raw);
      addUser(raw);

      const meatTag = chooseMeatTag(raw);

      if (s.includes('ä»Šæ—¥é£Ÿå’©') || s.includes('é£Ÿå’©å¥½') || s.includes('æœ‰å’©å¥½é£Ÿ') || s.includes('æ¨ä»‹') || s.includes('æ¨è–¦') || s.includes('what to eat') || (s.includes('what') && s.includes('eat'))) {
        flowEat();
        if (meatTag) recommend(meatTag);
        return;
      }

      if (s.includes('è¨‚ä½') || s.includes('è¨‚æ±') || s.includes('book') || s.includes('reservation') || s.includes('reserve')) {
        flowReservation();
        return;
      }

      if (s.includes('åˆ°æœƒ') || s.includes('å¤§é‡è¨‚è³¼') || s.includes('catering') || (s.includes('bulk') && s.includes('order'))) {
        flowCatering();
        return;
      }

      if (s.includes('å¤–è³£') || s.includes('è‡ªå–') || s.includes('takeaway') || s.includes('pickup') || s.includes('delivery')) {
        addBot(currentLang === 'zh' ? 'å¤–è³£ï¼è‡ªå–å¯ä»¥ç¶“å‘¢å€‹é€£çµè½å–®ï¼š' : 'Order takeaway / pickup here:');
        addBotHTML(`ğŸ‘‰ <a href="${ORDER_URL}" target="_blank">${t.orderLink}</a>`);
        return;
      }

      if (s.includes('å„ªæƒ ') || s.includes('promo') || s.includes('promotion') || s.includes('offer')) {
        addBot(currentLang === 'zh' ? 'æœ€æ–°å„ªæƒ å¯ä»¥å–ºé›»å­é¤ç‰Œè¦‹åˆ°ï¼š' : 'Latest promotions are in the e-menu:');
        addBotHTML(`ğŸ‘‰ <a href="${EMENU_URL}" target="_blank">${t.menuLink}</a>`);
        return;
      }

      if (meatTag){
        recommend(meatTag);
        return;
      }

      addBot(currentLang === 'zh'
        ? 'ä½ å¯ä»¥è©¦å“ï¼šä»Šæ—¥é£Ÿå’©å¥½ï¼Ÿï¼æƒ³é£Ÿç‰›ï¼å¹«æˆ‘è¨‚ä½ï¼åˆ°æœƒï¼å¤–è³£ï¼å„ªæƒ '
        : 'Try: what to eat / beef / booking / catering / takeaway / promotion'
      );
    }

    /************ events ************/
    hotKeysEl.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-text]');
      if (!btn) return;
      handleKeyword(btn.dataset.text);
    });

    sendBtn.addEventListener('click', () => {
      const v = input.value.trim();
      if (!v) return;
      input.value = '';
      handleKeyword(v);
    });

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        sendBtn.click();
      }
    });

    langBtn.addEventListener('click', () => {
      const next = (currentLang === 'zh') ? 'en' : 'zh';
      switchLangAndReload(next);
    });

    rsvWaBtn.addEventListener('click', (e) => {
      e.preventDefault();
      openWhatsAppReservation();
    });

    cateringWaBtn.addEventListener('click', (e) => {
      e.preventDefault();
      openWhatsAppCatering();
    });

    /************ init ************/
    (async function init(){
      applyLanguageUI();
      welcome();
      await loadMenu();
      if (menuData.length) {
        addBot(currentLang === 'zh'
          ? `å·²è¼‰å…¥æœ€æ–°èœå–®ï¼š${menuData.length} æ¬¾ã€‚`
          : `Live menu loaded: ${menuData.length} items.`
        );
      }
    })();
  </script>
</body>
</html>
