<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç¦é£Ÿå°åŠ©æ‰‹</title>

  <style>
    :root{
      --green:#2E7D32;
      --green-2:#43A047;
      --gold:#FFB74D;
      --bg:#F6EAD3;
      --ink:#1f2d1f;
      --card:rgba(255,255,255,.92);
      --line:rgba(46,125,50,.18);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      padding:18px 10px;
      display:flex;
      justify-content:center;
      background: radial-gradient(1200px 700px at 20% 10%, #fff 0%, var(--bg) 45%, #FDF2E9 100%);
      font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", "PingFang TC", Arial, sans-serif;
      color:var(--ink);
    }

    .chat-container{
      width:100%;
      max-width:460px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 22px;
      box-shadow: 0 18px 45px rgba(0,0,0,.10);
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap:10px;
      position:relative;
      overflow:hidden;
    }

    .chat-container:before{
      content:'';
      position:absolute;
      inset:-2px;
      background: linear-gradient(60deg, rgba(46,125,50,.45), rgba(255,183,77,.35));
      z-index:-1;
      border-radius: 24px;
      filter: blur(18px);
      opacity:.55;
    }

    .top-bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 6px 6px 12px 6px;
      border-bottom: 1px solid var(--line);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .brand img{
      width:40px;
      height:40px;
      border-radius:12px;
      object-fit:cover;
      border:1px solid rgba(46,125,50,.25);
      background:#fff;
    }

    .brand .title{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }

    .brand .title strong{
      font-size:18px;
      letter-spacing:.5px;
      color:var(--green);
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .brand .title span{
      font-size:12px;
      color:rgba(31,45,31,.7);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .lang-btn{
      border:1px solid rgba(46,125,50,.35);
      background: rgba(46,125,50,.06);
      color: var(--green);
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 12px;
      cursor:pointer;
      font-weight:600;
      transition:.15s;
      flex-shrink:0;
    }
    .lang-btn:hover{
      background: rgba(46,125,50,.12);
      transform: translateY(-1px);
    }

    .chat-window{
      flex:1;
      min-height: 280px;
      max-height: 460px;
      overflow:auto;
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      background: rgba(255,255,255,.75);
    }

    .msg{
      margin: 0 0 10px 0;
      font-size: 14px;
      line-height: 1.5;
      padding: 10px 12px;
      border-radius: 14px;
      max-width: 92%;
      word-break: break-word;
    }
    .bot{
      background: linear-gradient(135deg, rgba(46,125,50,.10), rgba(46,125,50,.05));
      border-left: 4px solid rgba(46,125,50,.55);
    }
    .user{
      margin-left:auto;
      text-align:right;
      background: linear-gradient(135deg, rgba(255,183,77,.22), rgba(255,183,77,.10));
      border-right: 4px solid rgba(255,183,77,.75);
    }

    .hot-keys{
      display:flex;
      gap:8px;
      overflow-x:auto;
      padding: 2px 2px;
      scrollbar-width:none;
    }
    .hot-keys::-webkit-scrollbar{display:none}

    .hot-key-btn{
      border:1px solid rgba(46,125,50,.30);
      background: rgba(46,125,50,.08);
      color: var(--green);
      padding: 9px 12px;
      border-radius: 999px;
      font-size: 13px;
      cursor:pointer;
      white-space:nowrap;
      transition:.15s;
      flex-shrink:0;
      font-weight:600;
    }
    .hot-key-btn:hover{
      background: rgba(46,125,50,.14);
      transform: translateY(-1px);
    }

    .forms{
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    #reservationForm, #cateringForm{
      display:none;
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      background: rgba(46,125,50,.04);
    }

    .row{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    .row label{
      width: 92px;
      font-size: 13px;
      color: rgba(31,45,31,.85);
      flex-shrink:0;
    }
    .row input, .row textarea{
      width: 100%;
      font-size: 13px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,.15);
      background: rgba(255,255,255,.9);
      outline: none;
    }
    .row textarea{min-height:56px; resize:vertical}

    .wa-btn{
      width:100%;
      border:none;
      border-radius: 999px;
      padding: 10px 12px;
      cursor:pointer;
      font-weight:700;
      color:#fff;
      background: linear-gradient(135deg, #25D366, #128C7E);
      transition:.15s;
    }
    .wa-btn:hover{ transform: translateY(-1px); }

    .input-area{
      display:flex;
      gap:8px;
      border-top:1px solid var(--line);
      padding-top:10px;
    }
    .input-area input{
      flex:1;
      border:1px solid rgba(46,125,50,.25);
      border-radius: 999px;
      padding: 11px 12px;
      font-size: 14px;
      outline:none;
      background: rgba(255,255,255,.92);
    }
    .input-area input:focus{
      border-color: rgba(46,125,50,.55);
      box-shadow: 0 0 0 4px rgba(46,125,50,.08);
    }
    .input-area button{
      border:none;
      border-radius: 999px;
      padding: 11px 16px;
      cursor:pointer;
      color:#fff;
      font-weight:800;
      background: linear-gradient(135deg, var(--green), var(--green-2));
      transition:.15s;
      white-space:nowrap;
    }
    .input-area button:hover{ transform: translateY(-1px); }

    a{ color:#1a73e8; text-decoration:none; }
    a:hover{ text-decoration:underline; }

    @media (max-width:600px){
      body{ padding:0; }
      .chat-container{
        max-width:100%;
        height:100vh;
        border-radius:0;
        box-shadow:none;
      }
      .chat-window{ max-height:none; }
    }
  </style>
</head>

<body>
  <div class="chat-container">
    <div class="top-bar">
      <div class="brand">
        <!-- 1) æ”¹ LOGO_SRCï¼šä½ å¯ä»¥æ”¾æœ¬åœ°æª”æ¡ˆå æˆ– ç¶²ä¸ŠURL -->
        <img id="logoImg" alt="FuShi Logo" />
        <div class="title">
          <strong id="titleText">ç¦é£Ÿå°åŠ©æ‰‹</strong>
          <span id="subTitleText">FuShi Food Assistant</span>
        </div>
      </div>
      <button id="langBtn" class="lang-btn">EN</button>
    </div>

    <div id="chat" class="chat-window"></div>

    <div class="hot-keys" id="hotKeys">
      <button class="hot-key-btn" data-text="ä»Šæ—¥é£Ÿå’©å¥½ï¼Ÿ">ğŸ´ ä»Šæ—¥é£Ÿå’©å¥½ï¼Ÿ</button>
      <button class="hot-key-btn" data-text="æƒ³é£Ÿç‰›">ğŸ® ç‰›</button>
      <button class="hot-key-btn" data-text="æƒ³é£Ÿé›">ğŸ” é›</button>
      <button class="hot-key-btn" data-text="æƒ³é£Ÿè±¬">ğŸ· è±¬</button>
      <button class="hot-key-btn" data-text="æƒ³é£Ÿæµ·é®®">ğŸ¦ æµ·é®®</button>
      <button class="hot-key-btn" data-text="æƒ³é£Ÿç´ ">ğŸ¥¬ ç´ é£Ÿ</button>
      <button class="hot-key-btn" data-text="å¹«æˆ‘è¨‚ä½">ğŸ“… è¨‚ä½</button>
      <button class="hot-key-btn" data-text="åˆ°æœƒï¼å¤§é‡è¨‚è³¼">ğŸ“¦ åˆ°æœƒ</button>
      <button class="hot-key-btn" data-text="å¤–è³£ï¼è‡ªå–">ğŸ¥¡ å¤–è³£</button>
      <button class="hot-key-btn" data-text="æœ‰å†‡å„ªæƒ ">ğŸ§§ å„ªæƒ </button>
    </div>

    <div class="forms">
      <!-- è¨‚ä½è¡¨å–® -->
      <div id="reservationForm">
        <div class="row">
          <label id="lblRsvPax">äººæ•¸</label>
          <input id="rsvPax" type="number" min="1" placeholder="ä¾‹å¦‚ 4" />
        </div>
        <div class="row">
          <label id="lblRsvDate">æ—¥æœŸ</label>
          <input id="rsvDate" type="date" />
        </div>
        <div class="row">
          <label id="lblRsvTime">æ™‚é–“</label>
          <input id="rsvTime" type="time" />
        </div>
        <div class="row">
          <label id="lblRsvPhone">é›»è©±</label>
          <input id="rsvPhone" type="tel" placeholder="852XXXXXXXX" />
        </div>
        <button id="rsvWaBtn" class="wa-btn">ç”¨ WhatsApp å‚³é€è¨‚ä½è³‡æ–™</button>
      </div>

      <!-- åˆ°æœƒ / å¤§é‡è¨‚è³¼è¡¨å–® -->
      <div id="cateringForm">
        <div class="row">
          <label id="lblCatOccasion">ç”¨é€”</label>
          <input id="catOccasion" type="text" placeholder="å…¬å¸æ´»å‹• / ç”Ÿæ—¥æœƒâ€¦" />
        </div>
        <div class="row">
          <label id="lblCatPax">äººæ•¸/ä»½é‡</label>
          <input id="catPax" type="text" placeholder="ä¾‹å¦‚ï¼š20äºº / 30ç›’é£¯" />
        </div>
        <div class="row">
          <label id="lblCatDate">æ—¥æœŸ</label>
          <input id="catDate" type="date" />
        </div>
        <div class="row">
          <label id="lblCatTime">æ™‚é–“</label>
          <input id="catTime" type="time" />
        </div>
        <div class="row">
          <label id="lblCatItems">èœå¼/Set</label>
          <textarea id="catItems" placeholder="ä¾‹å¦‚ï¼šåˆ°æœƒAå¥—é¤ x2, Bå¥—é¤ x1"></textarea>
        </div>
        <div class="row">
          <label id="lblCatContact">è¯çµ¡</label>
          <input id="catContact" type="text" placeholder="Mr Chan 9xxxxxxx" />
        </div>
        <button id="cateringWaBtn" class="wa-btn">ç”¨ WhatsApp å‚³é€åˆ°æœƒ/å¤§é‡è¨‚è³¼è³‡æ–™</button>
      </div>
    </div>

    <div class="input-area">
      <input id="userInput" type="text" placeholder="è«‹ç›´æ¥è¼¸å…¥ä½ çš„å•é¡Œï¼Œä¾‹å¦‚ï¼šæœ‰å’©å¥½é£Ÿã€è¨‚ä½ã€åˆ°æœƒã€å¤–è³£ã€å„ªæƒ â€¦" />
      <button id="sendBtn">é€å‡º</button>
    </div>
  </div>

  <script>
    /***********************
     * ä½ éœ€è¦æ”¹å˜… 2-3 å€‹åœ°æ–¹
     ***********************/
    // 2) æ”¹æˆä½ ã€ŒçœŸæ­£éƒ¨ç½²å‡ºåšŸã€å˜… Web App URLï¼ˆå””ä¿‚ Sheet IDï¼‰
    // æ­£ç¢ºæ ¼å¼ï¼š https://script.google.com/macros/s/XXXXXX/exec?type=menu
    const MENU_API_URL = 'https://script.google.com/macros/s/PUT_YOUR_DEPLOYMENT_ID_HERE/exec?type=menu';

    // 3) Logo åœ–ç‰‡ï¼šåŒ folder æ”¾ 107618.jpg å°±ç”¨å‘¢å¥ï¼›æˆ–è€…ç”¨ https://... åœ–ç‰‡ URL
    const LOGO_SRC = '107618.jpg';

    // WhatsApp æ¥æ”¶é›»è©±
    const WA_PHONE = '85264067605';

    // å›ºå®šé€£çµ
    const EMENU_URL = 'https://heyzine.com/flip-book/FuShiç¦é£ŸMenu';
    const ORDER_URL = 'https://fushi.softether.net/byod/byod.aspx?data=hwZVZ%2BqRSxraTV9YHWCRmw%3D%3D';

    /***********************
     * DOM
     ***********************/
    const chat = document.getElementById('chat');
    const input = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const langBtn = document.getElementById('langBtn');
    const titleText = document.getElementById('titleText');
    const subTitleText = document.getElementById('subTitleText');
    const hotKeys = document.getElementById('hotKeys');

    const rsvForm = document.getElementById('reservationForm');
    const cateringForm = document.getElementById('cateringForm');

    const rsvPaxInput = document.getElementById('rsvPax');
    const rsvDateInput = document.getElementById('rsvDate');
    const rsvTimeInput = document.getElementById('rsvTime');
    const rsvPhoneInput = document.getElementById('rsvPhone');
    const rsvWaBtn = document.getElementById('rsvWaBtn');

    const catOccasionInput = document.getElementById('catOccasion');
    const catPaxInput = document.getElementById('catPax');
    const catDateInput = document.getElementById('catDate');
    const catTimeInput = document.getElementById('catTime');
    const catItemsInput = document.getElementById('catItems');
    const catContactInput = document.getElementById('catContact');
    const cateringWaBtn = document.getElementById('cateringWaBtn');

    document.getElementById('logoImg').src = LOGO_SRC;

    let currentLang = 'zh';
    let menuData = []; // normalized

    const i18n = {
      title: { zh: 'ç¦é£Ÿå°åŠ©æ‰‹', en: 'FuShi Food Assistant' },
      sub:   { zh: 'å³å•å³ç­” Â· è¨‚ä½ Â· åˆ°æœƒ Â· å¤–è³£', en: 'Ask Â· Booking Â· Catering Â· Takeaway' },
      placeholder: {
        zh: 'è«‹ç›´æ¥è¼¸å…¥ä½ çš„å•é¡Œï¼Œä¾‹å¦‚ï¼šæœ‰å’©å¥½é£Ÿã€è¨‚ä½ã€åˆ°æœƒã€å¤–è³£ã€å„ªæƒ â€¦',
        en: 'Type your question: menu, recommendation, booking, catering, takeaway, promotionâ€¦'
      },
      welcome: {
        zh: ['å“ˆå›‰ï½ æ­¡è¿åšŸåˆ°ã€Œç¦é£Ÿã€ï¼', 'ä½ å¯ä»¥æ’³ä¸Šé¢å¿«æ·éµï¼Œæˆ–è€…ç›´æ¥æ‰“å­—å•æˆ‘ã€‚'],
        en: ['Hi! Welcome to "FuShi".', 'Use the hot keys above or type your question.']
      },
      menuLoadFail: {
        zh: 'æš«æ™‚æœªèƒ½è¼‰å…¥æœ€æ–°èœå–®ï¼ˆä½ ä»å¯ç”¨é›»å­é¤ç‰Œï¼‰ã€‚',
        en: 'Unable to load live menu for now (you can still use the e-menu).'
      },
      askMeat: {
        zh: 'ä»Šæ—¥æƒ³é£Ÿå’©ï¼Ÿä¾‹å¦‚ï¼šç‰›ã€é›ã€è±¬ã€æµ·é®®ã€ç´ é£Ÿï¼ˆä½ å¯ä»¥æ’³å¿«æ·éµï¼‰ã€‚',
        en: 'Any preference? Beef / Chicken / Pork / Seafood / Vegan (use hot keys).'
      },
      picked: {
        zh: 'æˆ‘å¹«ä½ æ€å’—å¹¾æ¬¾ï¼š',
        en: 'Here are some picks:'
      },
      noMatch: {
        zh: 'æš«æ™‚æœªæµåˆ°ç¬¦åˆæ¢ä»¶å˜…èœå¼ï¼Œä½ å¯ä»¥é–‹é›»å­é¤ç‰Œç‡æ›´å¤šï¼š',
        en: 'No matching dish for now. You can open the e-menu:'
      },
      menuLink: { zh: 'é›»å­é¤ç‰Œ', en: 'E-menu' },
      orderLink: { zh: 'ç¶²ä¸Šè½å–®', en: 'Online order' },
      formIntroRsv: {
        zh: 'å¥½å‘€ï½è«‹å¡«å¯«ä¸‹é¢è³‡æ–™ï¼Œä¹‹å¾Œä¸€æ’³å°±æœƒé–‹ WhatsApp åŒæˆ‘å“‹ç¢ºèªã€‚',
        en: 'Sureâ€”fill in the form and click to open WhatsApp for confirmation.'
      },
      formIntroCat: {
        zh: 'åˆ°æœƒï¼å¤§é‡è¨‚è³¼ï¼šå¡«å¯«è³‡æ–™å¾Œä¸€æ’³å°±æœƒé–‹ WhatsApp å‚³é€ä¿¾æˆ‘å“‹ã€‚',
        en: 'Catering / bulk order: fill in details and send via WhatsApp.'
      },
      sentHint: {
        zh: 'å·²é–‹å•Ÿ WhatsAppï¼Œæˆ‘å“‹æœƒç›¡å¿«å›è¦†ä½ ç¢ºèªã€‚',
        en: 'WhatsApp opened. We will reply shortly to confirm.'
      }
    };

    function addBot(text){
      const div = document.createElement('div');
      div.className = 'msg bot';
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }
    function addBotHTML(html){
      const div = document.createElement('div');
      div.className = 'msg bot';
      div.innerHTML = html;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }
    function addUser(text){
      const div = document.createElement('div');
      div.className = 'msg user';
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }
    function normalizeText(s){ return (s || '').toString().toLowerCase().trim(); }

    function applyLang(){
      titleText.textContent = i18n.title[currentLang];
      subTitleText.textContent = i18n.sub[currentLang];
      input.placeholder = i18n.placeholder[currentLang];
      langBtn.textContent = (currentLang === 'zh') ? 'EN' : 'ä¸­æ–‡';
    }

    function welcome(){
      chat.innerHTML = '';
      rsvForm.style.display = 'none';
      cateringForm.style.display = 'none';
      i18n.welcome[currentLang].forEach(addBot);
    }

    // å…¼å®¹ä½ è€Œå®¶ Apps Script å¯èƒ½å›å‚³ï¼šitem/item_zh/item_en, meat/Meat/è‚‰é¡, price/Price
    function normalizeMenuRow(row){
      const period = row.period || row['Available Period'] || row['available period'] || 'All Day';
      const nameZh = row.item_zh || row['Item in Chinese'] || row.item || '';
      const nameEn = row.item_en || row['Item in english'] || row['Item in English'] || '';
      const meat = row.meat || row.Meat || row['è‚‰é¡'] || '';
      const price = row.price ?? row.Price ?? null;

      return {
        period: (period || 'All Day').toString().trim(),
        nameZh: (nameZh || '').toString().trim(),
        nameEn: (nameEn || '').toString().trim(),
        meat: (meat || '').toString().trim(),
        price: (price === '' || price == null) ? null : Number(price)
      };
    }

    async function loadMenu(){
      try{
        const res = await fetch(MENU_API_URL, { cache: 'no-store' });
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        menuData = (Array.isArray(data) ? data : [])
          .map(normalizeMenuRow)
          .filter(x => x.nameZh || x.nameEn);

      }catch(e){
        console.error('loadMenu error', e);
        addBot(i18n.menuLoadFail[currentLang]);
        addBotHTML(`ğŸ‘‰ <a href="${EMENU_URL}" target="_blank">${i18n.menuLink[currentLang]}</a>`);
      }
    }

    function chooseMeatTag(raw){
      const t = normalizeText(raw);
      if (t.includes('ç‰›') || t.includes('beef')) return 'Beef';
      if (t.includes('é›') || t.includes('chicken')) return 'Chicken';
      if (t.includes('è±¬') || t.includes('pork')) return 'Pork';
      if (t.includes('æµ·é®®') || t.includes('seafood') || t.includes('sea food')) return 'Sea Food';
      if (t.includes('ç´ ') || t.includes('vegan') || t.includes('veg')) return 'Vegan';
      return null;
    }

    function formatLine(d){
      const name = (currentLang === 'zh') ? (d.nameZh || d.nameEn) : (d.nameEn || d.nameZh);
      const alt  = (currentLang === 'zh') ? (d.nameEn ? `ï¼ˆ${d.nameEn}ï¼‰` : '') : (d.nameZh ? `(${d.nameZh})` : '');
      const price = (d.price == null || Number.isNaN(d.price)) ? '' : ` - HK$${d.price}`;
      return `â€¢ ${name}${alt}${price}`;
    }

    function recommendDishes(meatTag){
      if(!menuData.length){
        addBot(i18n.menuLoadFail[currentLang]);
        addBotHTML(`ğŸ‘‰ <a href="${EMENU_URL}" target="_blank">${i18n.menuLink[currentLang]}</a>`);
        return;
      }

      const list = menuData
        .filter(d => normalizeText(d.meat) === normalizeText(meatTag))
        .slice(0, 3);

      if(!list.length){
        addBot(i18n.noMatch[currentLang]);
        addBotHTML(`ğŸ‘‰ <a href="${EMENU_URL}" target="_blank">${i18n.menuLink[currentLang]}</a>`);
        return;
      }

      addBot(i18n.picked[currentLang]);
      addBotHTML(list.map(formatLine).join('<br>'));
      addBotHTML(`ğŸ‘‰ <a href="${EMENU_URL}" target="_blank">${i18n.menuLink[currentLang]}</a>`);
    }

    function flowEat(){
      rsvForm.style.display = 'none';
      cateringForm.style.display = 'none';
      addBot(i18n.askMeat[currentLang]);
    }

    function flowReservation(){
      cateringForm.style.display = 'none';
      rsvForm.style.display = 'block';
      addBot(i18n.formIntroRsv[currentLang]);
    }

    function flowCatering(){
      rsvForm.style.display = 'none';
      cateringForm.style.display = 'block';
      addBot(i18n.formIntroCat[currentLang]);
    }

    function openWhatsAppReservation(){
      const pax = rsvPaxInput.value || '';
      const date = rsvDateInput.value || '';
      const time = rsvTimeInput.value || '';
      const contact = rsvPhoneInput.value || '';

      const msgZh =
`æˆ‘æƒ³å–ºã€Œç¦é£Ÿã€è¨‚ä½ï¼š
äººæ•¸ï¼š${pax ? pax + 'ä½' : ''}
æ—¥æœŸï¼š${date}
æ™‚é–“ï¼š${time}
è¯çµ¡é›»è©±ï¼š${contact}
éº»ç…©å¹«æˆ‘ç¢ºèªå®‰æ’ï¼Œå””è©²æ™’ï¼`.trim();

      const msgEn =
`I would like to make a booking at "FuShi":
People: ${pax}
Date: ${date}
Time: ${time}
Contact: ${contact}
Please help confirm the booking. Thank you!`.trim();

      const text = (currentLang === 'zh') ? msgZh : msgEn;
      window.open(`https://wa.me/${WA_PHONE}?text=${encodeURIComponent(text)}`, '_blank');
      addBot(i18n.sentHint[currentLang]);
    }

    function openWhatsAppCatering(){
      const occ = catOccasionInput.value || '';
      const pax = catPaxInput.value || '';
      const date = catDateInput.value || '';
      const time = catTimeInput.value || '';
      const items = catItemsInput.value || '';
      const contact = catContactInput.value || '';

      const msgZh =
`æˆ‘æƒ³å–ºã€Œç¦é£Ÿã€å®‰æ’åˆ°æœƒï¼å¤§é‡è¨‚è³¼ï¼š
ç”¨é€”ï¼š${occ}
äººæ•¸ï¼ä»½é‡ï¼šç´„ ${pax}
æ—¥æœŸï¼š${date}
æ™‚é–“ï¼š${time}
æƒ³è¦å˜…å¥—é¤ï¼èœå¼ï¼š${items}
è¯çµ¡äººï¼é›»è©±ï¼š${contact}
éº»ç…©æä¾›å¥—é¤æˆ–å»ºè­°ï¼Œå¤šè¬ï¼`.trim();

      const msgEn =
`I would like to arrange catering / bulk order at "FuShi":
Occasion: ${occ}
Pax / Quantity: ${pax}
Date: ${date}
Time: ${time}
Preferred sets / dishes: ${items}
Contact: ${contact}
Please suggest suitable sets/options. Thank you!`.trim();

      const text = (currentLang === 'zh') ? msgZh : msgEn;
      window.open(`https://wa.me/${WA_PHONE}?text=${encodeURIComponent(text)}`, '_blank');
      addBot(i18n.sentHint[currentLang]);
    }

    function handleKeyword(raw){
      const t = normalizeText(raw);
      addUser(raw);

      const meatTag = chooseMeatTag(raw);

      if (t.includes('ä»Šæ—¥é£Ÿå’©') || t.includes('é£Ÿå’©å¥½') || t.includes('æœ‰å’©å¥½é£Ÿ') || t.includes('æ¨è–¦') || t.includes('æ¨ä»‹') || t.includes('recommend')) {
        flowEat();
        if (meatTag) recommendDishes(meatTag);
        return;
      }

      if (t.includes('è¨‚ä½') || t.includes('è¨‚æ±') || t.includes('book') || t.includes('reservation') || t.includes('reserve')) {
        flowReservation();
        return;
      }

      if (t.includes('åˆ°æœƒ') || t.includes('å¤§é‡è¨‚è³¼') || t.includes('catering') || (t.includes('bulk') && t.includes('order'))) {
        flowCatering();
        return;
      }

      if (t.includes('å¤–è³£') || t.includes('è‡ªå–') || t.includes('takeaway') || t.includes('pickup') || t.includes('delivery')) {
        addBot(currentLang === 'zh' ? 'å¤–è³£ï¼è‡ªå–å¯ä»¥ç¶“å‘¢å€‹é€£çµè½å–®ï¼š' : 'Order takeaway / pickup here:');
        addBotHTML(`ğŸ‘‰ <a href="${ORDER_URL}" target="_blank">${i18n.orderLink[currentLang]}</a>`);
        return;
      }

      if (t.includes('å„ªæƒ ') || t.includes('promo') || t.includes('promotion') || t.includes('offer')) {
        addBot(currentLang === 'zh' ? 'æœ€æ–°å„ªæƒ å¯ä»¥å–ºé›»å­é¤ç‰Œè¦‹åˆ°ï¼š' : 'Latest promotions are in the e-menu:');
        addBotHTML(`ğŸ‘‰ <a href="${EMENU_URL}" target="_blank">${i18n.menuLink[currentLang]}</a>`);
        return;
      }

      if (meatTag){
        recommendDishes(meatTag);
        return;
      }

      addBot(currentLang === 'zh'
        ? 'ä½ å¯ä»¥è©¦å“ï¼šä»Šæ—¥é£Ÿå’©å¥½ï¼Ÿï¼æƒ³é£Ÿç‰›ï¼å¹«æˆ‘è¨‚ä½ï¼åˆ°æœƒï¼å¤–è³£ï¼å„ªæƒ '
        : 'Try: what to eat / beef / booking / catering / takeaway / promotions'
      );
    }

    // events
    hotKeys.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-text]');
      if(!btn) return;
      handleKeyword(btn.getAttribute('data-text'));
    });

    sendBtn.addEventListener('click', () => {
      const v = input.value.trim();
      if(!v) return;
      input.value = '';
      handleKeyword(v);
    });

    input.addEventListener('keydown', (e) => {
      if(e.key === 'Enter'){
        e.preventDefault();
        sendBtn.click();
      }
    });

    langBtn.addEventListener('click', () => {
      currentLang = (currentLang === 'zh') ? 'en' : 'zh';
      applyLang();
      addBot(currentLang === 'zh' ? 'å·²åˆ‡æ›ä¸­æ–‡ä»‹é¢ã€‚' : 'Switched to English.');
    });

    rsvWaBtn.addEventListener('click', (e) => {
      e.preventDefault();
      openWhatsAppReservation();
    });

    cateringWaBtn.addEventListener('click', (e) => {
      e.preventDefault();
      openWhatsAppCatering();
    });

    // init
    (async function init(){
      applyLang();
      welcome();
      await loadMenu();
      // å¦‚æœæˆåŠŸæœ‰ menuDataï¼Œæç¤ºä¸€ä¸‹ï¼ˆå””å¤ªåµï¼‰
      if(menuData.length){
        addBot(currentLang === 'zh'
          ? `å·²è¼‰å…¥æœ€æ–°èœå–®ï¼š${menuData.length} æ¬¾ã€‚æƒ³é£Ÿå’©ï¼Ÿ`
          : `Live menu loaded: ${menuData.length} items. What are you craving?`
        );
      }
    })();
  </script>
</body>
</html>